<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>é™æ™‚æ¶åˆ¸</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:#000;color:#fff;text-align:center;padding:40px 20px}
    h1{font-size:24px;margin-bottom:8px}p{font-size:14px;color:#aaa;margin-bottom:30px}
    .coupon{background:linear-gradient(135deg,#00d4ff 0%,#0099cc 100%);color:#000;border-radius:12px;padding:20px;margin:0 auto 20px;max-width:280px;box-shadow:0 8px 20px rgba(0,212,255,.35)}
    .coupon strong{font-size:32px}.coupon small{font-size:14px}
    button{background:#fff;color:#000;border:none;padding:16px 32px;font-size:18px;font-weight:600;border-radius:12px;width:100%;max-width:300px;cursor:pointer;transition:.3s}
    button:disabled{background:#666;cursor:not-allowed}
    #timer{font-size:36px;font-weight:700;margin:20px 0}
  </style>
</head>
<body>
  <h1>é™æ™‚æ¶åˆ¸</h1><p>å€’æ•¸çµæŸå³é—œé–‰ï¼Œç«‹å³é ˜å–ï¼</p>
  <div id="timer">05:00</div>
  <div class="coupon"><strong>50 å…ƒ</strong><br><small>æ»¿ 100 å…ƒè‡ªå‹•æŠ˜æŠµ</small></div>
  <button id="claimBtn" onclick="claim()">ç«‹å³é ˜å–</button>
  <div id="status"></div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
  const liffId='2008784977-Flash001'; // ç¨å¾Œæ›¿æ›æˆå¯¦éš› LIFF ID
  let remain=300;
  async function init(){await liff.init({liffId});}
  init();

  function pad(n){return n<10?'0'+n:n}
  function countdown(){
    if(remain<=0){document.getElementById('timer').textContent='00:00';document.getElementById('claimBtn').disabled=true;showStatus('æœ¬è¼ªæ¶åˆ¸å·²çµæŸ','error');return;}
    const m=Math.floor(remain/60),s=remain%60;
    document.getElementById('timer').textContent=`${pad(m)}:${pad(s)}`;
    remain--;
    setTimeout(countdown,1000);
  }countdown();

  function showStatus(msg,type){
    const st=document.getElementById('status');
    st.textContent=msg;st.className=type;
  }

  async function claim(){
    if(!liff.isInClient()){showStatus('è«‹åœ¨ LINE å…§é–‹å•Ÿ','error');return;}
    const userId=liff.getDecodedIDToken()?.sub;
    const rs=await fetch('/api/coupon/flash',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({userId})
    }).then(r=>r.json());
    if(rs.ok){
      await liff.sendMessages([{type:'text',text:'ğŸ« é™æ™‚åˆ¸å·²å…¥è¢‹ï¼æ»¿ 100 å…ƒè‡ªå‹•æŠ˜æŠµ 50 å…ƒï¼Œ7 å¤©å…§æœ‰æ•ˆã€‚'}]);
      setTimeout(()=>liff.closeWindow(),1000);
    }else{showStatus(rs.msg||'å·²é ˜é/åé¡æ»¿','error');}
  }
  </script>
</body>
</html>
